# 균형 이진 탐색 트리

## 균형 이진 탐색 트리의 개념

<img width="481" alt="image" src="https://github.com/HoyeongJeon/DKU/assets/78394999/4470ca94-e1b9-41de-a5c7-f927ba392905">

이진 탐색 트리의 경우 최소 높이를 가진 경우(a) O(log n) 시간 복잡도를 가진다. (b)와 같이 최대 높이를 가진 경우엔 O(n)이 된다.
따라서 이진 탐색 트리가 한쪽으로 치우치지 않고 균형을 이루도록 맞춰주면 탐색 성능을 높일 수 있음.
-> 이러한 원리로 이진 탐색 트리에 왼쪽 서브 트리의 높이와 오른쪽 서브 트리의 높이에 대한 균형 조건을 추가하여 정의한 것이 균형 이진 탐색 트리(Balanced Binary Search Tree) 또는 균형 트리(Balanced Tree)라고 한다.

## AVL 트리의 개념과 유형

AVL 트리는 각 노드에서 왼쪽 서브 트리의 높이 hL(height of left subtree)과 오른쪽 서브 트리의 높이 hR(height of right subtree)의 차이가 1을 넘지 않는 이진 탐색 트리이다.
BF(균형 인수) = hL - hR
|hL - hR| <= 1

### AVL 트리의 특징

- 왼쪽 서브 트리 < 부모 노드 < 오른쪽 서브 트리
- 각 노드의 왼쪽 서브 트리 높이와 오른쪾 서브 트리 높이의 차이(hL-hR)인 노드의 균형 인수 BF(Balance Factor)가 -1, 0, 1인 이진 탐색 트리
- 각 노드의 균형 인수로 [-1, 0, 1]의 값만 가지게 함으로써 왼쪽 서브 트리와 오른쪽 서브 트리의 균형을 항상 유지함.

균형 인수 BF는 다음 그림과 같이 각 노드에서 왼쪽 서브 트리의 높이 hL과 오른쪽 서브 트리의 높이 hR의 차이를 통해 구함.
<img width="422" alt="image" src="https://github.com/HoyeongJeon/DKU/assets/78394999/1738e12c-fb68-4e6d-b3b8-419a85272996">

다음 그림의 이진 탐색 트리는 모든 노드가 균형 인수로 {-1, 0, 1}의 값을 가지므로 AVL 트리이다.
<img width="472" alt="image" src="https://github.com/HoyeongJeon/DKU/assets/78394999/6f57e2e4-cf3c-4925-a96c-2e406cb7b945">

다음 그림의 이진 탐색 트리는 노드들이 균형 인수로 {-1, 0, 1} 외의 값을 가지므로 균형이 깨져 한 방향으로 치우친 비AVL 트리이다.
<img width="459" alt="image" src="https://github.com/HoyeongJeon/DKU/assets/78394999/f416810a-c419-4998-abc9-b18c5cde123a">

균형이 깨진 노드의 균형 인수가 +이면 왼쪽 서브 트리에 문제가 있는 것이고 (왼쪽으로 치우쳐 있고), -이면 오른쪽 서브 트리에 문제가 있는 것(오른쪽으로 치우쳐 있음).

**(a) LL유형**
노드 50의 균형 인수가 +2로 균형이 깨진 노드.
균형 인수가 + 이므로 왼쪽 서브 트리에 문제가 있다.
왼쪽 서브 트리를 확인해 보면 노드 50의 왼쪽(L) 자식인 20의 균형인수가 +이므로 노드 20의 왼쪽(L) 자식 노드와 그의 왼쪽(L) 자식 노드에 의해 왼쪽으로 치우쳐져 있음을 알 수 있다.
이러한 불균형 문제를 LL(Left-Left)유형이라 한다.

**(b) RR유형**
노드 50의 균형 인수가 -2로 균형이 깨진 노드.
균형 인수가 - 이므로 오른쪽 서브 트리에 문제가 있다.
오른쪽 서브 트리를 확인해 보면 노드 50의 오른쪽(R) 자식인 55의 균형인수가 -이므로 노드 50의 오른쪽(R) 자식 노드와 그의 오른쪽(R) 자식 노드 55에 의해 오른쪽으로 치우쳐져 있음을 알 수 있다.
이러한 불균형 문제를 RR(Right-Right)유형이라 한다.

**(c) LR유형**
노드 55의 균형 인수가 +2로 균형이 깨진 노드.
균형 인수가 + 이므로 왼쪽 서브 트리에 문제가 있다.
왼쪽 서브 트리를 확인해 보면 노드 55의 왼쪽(L) 자식인 20의 균형인수가 -이므로 노드 55의 왼쪽(L) 자식 노드와 그의 오른쪽(R) 자식 노드에 의해 왼쪽 서브 트리가 치우쳐져 있다.
이러한 불균형 문제를 LR(Left-Right)유형이라 한다.

**(d) RL유형**
노드 60의 균형 인수가 -2 이므로 오른쪽 서브 트리에 문제가 있다.
노드 60의 오른쪽(R)의 자식인 노드 65의 균형 인수는 +이므로 노드 65의 왼쪽(L) 자식 노드가 불균형과 관련 있다. 따라서 노드 60이 불균형 노드가 된 이유는 오른쪽(R) 자식 노드와 그의 왼쪽(L) 자식 노드로 인해 오른쪽으로 서브 트리가 치우쳤기 때문이다.
이러한 불균형 문제를 RL(Right-Left)유형이라 한다.

## AVL 트리의 회전 연산

이진 탐색 트리에서 노드 삭제 후 트리를 재구성하는 작업이 필요한 것처럼 AVL 트리에선 삽입과 삭제 후 균형 인수를 확이나여 균형을 맞추는 재구성 작업이 필요하다. AVL 트리에서 수행하는 삽입/삭제 작업은 이진 탐색 트리에서의 삽입/삭제 작업과 같고, 이후에 균형을 맞추는 재구성 작업이 추가되는데 이를 회전(Rotation) 연산이라 한다.

<img width="486" alt="image" src="https://github.com/HoyeongJeon/DKU/assets/78394999/0ce5ffe4-be3f-4166-a324-e848bfab72d8">

LL 회전과 RR 회전과 같이 한 번 회전하는 것을 단순 회전(Single Rotation)이라 하고, LR 회전과 RL 회전과 같이 두 번 회전하는 것을 이중 회전(Double Rotation)이라 한다.

### LL 회전

LL 불균형을 해결하기 위한 회전
아래 그림처럼 균형 인수에 문제가 생긴 노드 L1과 그의 왼쪽 자식 노드 L2가 있을 때, L1과 L1의 왼쪽 자식 노드 L2를 오른쪽으로 회전시키면 L2의 부모였던 L1이 L2의 오른쪽 자식 노드가 되면서 균형이 회복된다.
<img width="327" alt="image" src="https://github.com/HoyeongJeon/DKU/assets/78394999/ac4e29ad-63fe-4179-8c62-eadf9f9329bc">

위 LL 회전 과정을 알고리즘으로 정리하면 다음과 같다.
<img width="481" alt="image" src="https://github.com/HoyeongJeon/DKU/assets/78394999/57772af7-3fec-41bc-b2e5-daff5f8ea6da">

-> LL 회전은 왼쪽으로 치우친 문제를 해결하기 위해 오른쪽으로 해결하는 방식

### RR 회전

RR 불균형을 해결하기 위한 회전
아래 그림처럼 균형 인수에 문제가 생긴 노드 L1과 그의 오른쪽 자식 노드 L2가 있을 때, L1과 L1의 오른쪽 자식 노드 L2를 왼쪽으로 회전시키면 L2의 부모였던 L1이 L2의 왼쪽 자식 노드가 되면서 균형이 회복된다.
<img width="328" alt="image" src="https://github.com/HoyeongJeon/DKU/assets/78394999/3e67b636-9d90-42fa-aee6-0f3717500c86">

위 RR 회전 과정을 알고리즘으로 정리하면 다음과 같다.
<img width="473" alt="image" src="https://github.com/HoyeongJeon/DKU/assets/78394999/44a0d5d4-057d-4f28-a73e-50c55ab4324a">

-> RR 회전은 오른쪽으로 치우친 문제를 해결하기 위해 왼쪽으로 해결하는 방식

### LR 회전

LR 회전은 회전 연산을 두 번 수행하는 이중 회전(Double Rotation)이다.
불균형 문제가 있는 구간의 하위 레벨에서 수행하는 1차 회전은 균형 인수에 문제가 생긴 노드 L1의 왼쪽 자식 노드 L2와 L2의 오른쪽 자식 노드 L3을 왼쪽으로 회전시키는 RR 회전이다.
1차 회전으로 오른쪽 자식 노드인 L3이 왼쪽으로 회전하여 L2의 부모 노드가 되고, 부모 노드였던 L2는 L3의 왼쪽 자식 노드가 되어 L1-L3-L2의 LL 유형이 된다.
이 상태에서 2차 회전으로 LL 회전을 수행한다.
<img width="479" alt="image" src="https://github.com/HoyeongJeon/DKU/assets/78394999/a6700ae0-6464-4ba5-b5b5-978ea2a50c0e">

위 과정을 알고리즘으로 정리하면 다음과 같다.
<img width="470" alt="image" src="https://github.com/HoyeongJeon/DKU/assets/78394999/2b9759f1-e9e3-46e6-b1fd-b9169ed8d483">

### RL 회전

RL 회전은 회전 연산을 두 번 수행하는 이중 회전(Double Rotation)이다.
불균형 문제가 있는 구간의 하위 레벨에서 수행하는 1차 회전은 균형 인수에 문제가 생긴 노드 L1의 오른쪽 자식 노드 L2와 L2의 왼쪽 자식 노드 L3을 오른쪽으로 회전시키는 LL 회전이다.
1차 회전으로 L2의 오른쪽 자식 노드였던 L3이 오른쪽으로 회전하여 L2의 부모 노드가 되고, 부모 노드였던 L2는 L3의 오른쪽 자식 노드가 되어 L1-L3-L2의 RR 유형이 된다.
이 상태에서 2차 회전으로 RR 회전을 수행한다.
<img width="436" alt="image" src="https://github.com/HoyeongJeon/DKU/assets/78394999/84d44523-8836-433f-b813-ec95feb00fae">

위 과정을 알고리즘으로 정리하면 다음과 같다.
<img width="472" alt="image" src="https://github.com/HoyeongJeon/DKU/assets/78394999/cf39c1c1-458b-4a5a-9012-a095540b2d50">
